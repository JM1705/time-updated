function schoolPeriod(e,o,i){this.title=e,this.startTime=new Date,this.startTime.setHours(o.split(":")[0]),this.startTime.setMinutes(o.split(":")[1]),this.startTime.setSeconds(0),this.endTime=new Date,this.endTime.setHours(i.split(":")[0]),this.endTime.setMinutes(i.split(":")[1]),this.endTime.setSeconds(0),this.times=[this.startTime,this.endTime]}function calculateNextPeriod(){var e=[new schoolPeriod("Period 1","8:40","10:05"),new schoolPeriod("Period 2","10:10","10:40"),new schoolPeriod("Mentor","11:05","11:20"),new schoolPeriod("Period 3","11:20","12:20"),new schoolPeriod("Period 4","12:25","13:25"),new schoolPeriod("Period 5","14:15","15:15")],o=[new schoolPeriod("Period 1","8:40","9:35"),new schoolPeriod("Period 2","9:35","10:30"),new schoolPeriod("Period 3","10:55","11:50"),new schoolPeriod("Period 4","11:50","12:45"),new schoolPeriod("Co-curricular","13:30","15:30")],i=[new schoolPeriod("Period 1","8:40","9:40"),new schoolPeriod("Period 2","9:40","10:40"),new schoolPeriod("Mentor","11:05","11:20"),new schoolPeriod("Period 3","11:20","12:20"),new schoolPeriod("Period 4","12:25","13:25"),new schoolPeriod("Period 5","14:15","15:15")],t=[new schoolPeriod("Mentor","8:30","8:45"),new schoolPeriod("Assembly","8:45","9:50"),new schoolPeriod("Period 2","9:55","10:55"),new schoolPeriod("Period 3","11:20","12:20"),new schoolPeriod("Period 4","12:25","13:25"),new schoolPeriod("Period 5","14:15","15:15")],n=[[e,i,o,e,e],[e,e,o,e,t]];n[1][1]=[new schoolPeriod("Period 1","8:40","9:40"),new schoolPeriod("Period 2","9:40","10:40"),new schoolPeriod("Mentor","11:05","11:20"),new schoolPeriod("Period 3","11:20","12:20"),new schoolPeriod("Period 4","12:25","13:25"),new schoolPeriod("House Assembly","14:15","15:15")],n[1][2]=[new schoolPeriod("Mentor","8:30","8:35"),new schoolPeriod("Assembly","8:35","10:00"),new schoolPeriod("Period 2","10:00","10:45"),new schoolPeriod("Period 3","11:10","11:55"),new schoolPeriod("Period 4","12:00","12:45"),new schoolPeriod("Co-curricular","13:30","15:30")],n[1][4]=[new schoolPeriod("Assembly","8:45","10:15"),new schoolPeriod("Period 2 (Yr 10 & 11)","10:25","11:10"),new schoolPeriod("Period 3 (Yr 10 & 11)","11:35","12:20")];var r=new Date,s=(new Date).getWeek(),d=s%2?0:1,a=[];0!=r.getDay()&&6!=r.getDay()&&(a=n[d][r.getDay()-1]);for(var c=new Date,l=0,P=0,u=!0,h="",m=0;m<a.length;m++)for(var w=0;2>w;w++)P=a[m].times[w]-r,P>0&&(l>P||1==u)&&(c=a[m].times[w],l=P,u=!1,h="Until "+a[m].title+(w?" ends":" starts"));1==u?(h="No periods left today",document.getElementById("timeLeft").innerHTML="Relax",document.getElementById("titleText").innerHTML="Timetable",tomorrow=new Date,tomorrow.setHours(24),tomorrow.setMinutes(0),tomorrow.setSeconds(0),setTimeout(calculateNextPeriod,tomorrow-r)):(console.log("New periodTime:",c),calculateTime(c)),document.getElementById("timeLabel").innerHTML=h,setRandomBackground()}function calculateTime(e){var o=new Date,i=(e-o)/1e3,t=Math.floor(i/3600),n=Math.floor(i/60)%60,r=Math.floor(i%60);n=formatTime(n),r=formatTime(r);var s=t+":"+n+":"+r;if(document.getElementById("timeLeft").innerHTML=s,document.getElementById("titleText").innerHTML=s,i>0)setTimeout(calculateTime.bind(e,e),500);else{var d=document.getElementById("timeLabel").innerHTML,a=d.replace("Until ","").replace(" starts","").replace(" ends",""),c=d.includes(" starts")?" has started":" has ended";spawnNotification("","./logo.png",a+c),calculateNextPeriod()}}function formatTime(e){return 10>e?"0"+e:e}function requestNotificationPermissions(){try{Notification.requestPermission(),notificationsSupported=!0}catch(e){console.log(e)}}function spawnNotification(e,o,i){if(0!=notificationsSupported){var t={body:e,icon:o};try{new Notification(i,t)}catch(n){console.log(n,"Using ServiceWorkerRegistration.showNotification() instead"),navigator.serviceWorker.register("sw.js"),Notification.requestPermission(function(e){"granted"===e&&navigator.serviceWorker.ready.then(function(e){e.showNotification(i,t)})})}}}function setRandomBackground(){$("#mainDiv").fadeOut(400,setRandomBackgroundLoad)}function setRandomBackgroundLoad(){var e=["./backgrounds/forestbridge.jpg","./backgrounds/landscape1.jpg","./backgrounds/landscape2.jpg","./backgrounds/landscape3.jpg","./backgrounds/landscape4.jpg","./backgrounds/landscape5.jpg","./backgrounds/landscape6.jpg","./backgrounds/landscape7.jpg"],o=Math.floor(Math.random()*e.length);o==lastBackgroundIndex&&(o++,o>=e.length&&(o=0)),lastBackgroundIndex=o;var i=e[o],t=new Image;t.onload=function(){$("#mainDiv").css("background-image","url("+t.src+")"),$("#mainDiv").fadeIn(400)},t.onerror=function(){$("#mainDiv").fadeIn(400)},t.src=i}$(document).ready(function(){requestNotificationPermissions(),$("#mainDiv").fadeOut(0),calculateNextPeriod()});var notificationsSupported=!1,lastBackgroundIndex=-1;Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)};
